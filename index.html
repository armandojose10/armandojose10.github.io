<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investigaci√≥n FOMO - EFoMU</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
        <!-- Header con logo y curso -->
        <div class="bg-white rounded-t-2xl shadow-lg p-4 flex justify-between items-center mb-0">
            <img src="./images/logo-utb.png" alt="UTB Logo" class="h-16 md:h-20" onerror="this.style.display='none'">
            <div class="text-right">
                <p class="text-indigo-700 font-bold text-lg md:text-xl">Curso: Psicometr√≠a</p>
            </div>
        </div>
        
        <div class="bg-white rounded-b-2xl shadow-xl p-8" id="app"></div>
    </div>
    
    <script>
        const state = {
            step: 'intro',
            demographics: {},
            responses: {},
            result: null
        };
        
        const questions = {
            phubbing: [
                {id:1,text:"Interrumpo mis conversaciones para revisar mi celular."},
                {id:4,text:"Reviso mi celular mientras camino acompa√±ado de alguien."},
                {id:5,text:"Interrumpo una conversaci√≥n para revisar mis notificaciones."},
                {id:6,text:"Prefiero mirar mi celular en lugar de interactuar con la persona que me acompa√±a."},
                {id:7,text:"Reviso mi dispositivo electr√≥nico mientras converso con otras personas."},
                {id:8,text:"Uso mi celular mientras alguien me est√° hablando."},
                {id:9,text:"Env√≠o mensajes durante una comida con otras personas."},
                {id:10,text:"Mantengo mi atenci√≥n en el celular aunque otra persona me est√© hablando."},
                {id:11,text:"Reviso el celular en lugar de continuar la charla con la persona que est√° conmigo."},
                {id:12,text:"Presto m√°s atenci√≥n al celular que a la persona con la que estoy hablando."},
                {id:13,text:"Interrumpo una conversaci√≥n para revisar mi celular."},
                {id:14,text:"Uso el celular durante una conversaci√≥n aunque no tenga una raz√≥n importante para hacerlo."}
            ],
            conexion: [
                {id:16,text:"Abro las redes sociales pocos minutos despu√©s de haberlas visto."},
                {id:17,text:"Siento la necesidad de revisar el celular sin motivo."},
                {id:18,text:"Reviso las redes sociales varias veces seguidas en poco tiempo."},
                {id:23,text:"Actualizo mis redes sociales varias veces al d√≠a para ver si hay algo nuevo."},
                {id:25,text:"Me cuesta ignorar el celular aunque est√© ocupado en otra actividad."},
                {id:26,text:"Paso de una aplicaci√≥n a otra sin un motivo claro."}
            ],
            angustia: [
                {id:31,text:"Me preocupa cuando no s√© qu√© est√°n haciendo mis amigos en redes sociales."},
                {id:32,text:"Se me dificulta pasar mucho tiempo sin revisar mis redes sociales."},
                {id:33,text:"Me siento inc√≥modo al ver que mis amigos publican fotos sin m√≠."},
                {id:34,text:"Me frustra perderme publicaciones importantes en redes sociales."},
                {id:36,text:"Siento angustia cuando no reviso las notificaciones a tiempo."},
                {id:38,text:"Me preocupa no estar al tanto de lo que mis amigos publican en redes sociales."},
                {id:39,text:"Siento ansiedad si paso varias horas sin revisar mis redes sociales."},
                {id:44,text:"Me siento excluido cuando mis amigos publican fotos sin m√≠."},
                {id:45,text:"Me siento angustiado cuando veo que todos est√°n en l√≠nea excepto yo."}
            ]
        };
        
        const baremoPhubbing = {
            Masculino: {12:{n:'BAJO',p:1},13:{n:'BAJO',p:6},14:{n:'BAJO',p:9},15:{n:'BAJO',p:13},16:{n:'MEDIO',p:16},17:{n:'MEDIO',p:17},18:{n:'MEDIO',p:18},19:{n:'MEDIO',p:23},20:{n:'MEDIO',p:26},21:{n:'MEDIO',p:27},22:{n:'MEDIO',p:30},23:{n:'MEDIO',p:34},24:{n:'MEDIO',p:39},25:{n:'MEDIO',p:49},26:{n:'MEDIO',p:52},27:{n:'MEDIO',p:57},28:{n:'MEDIO',p:63},29:{n:'MEDIO',p:64},30:{n:'MEDIO',p:71},31:{n:'MEDIO',p:73},32:{n:'MEDIO',p:75},33:{n:'MEDIO',p:78},34:{n:'MEDIO',p:79},35:{n:'MEDIO',p:80},36:{n:'MEDIO',p:83},37:{n:'MEDIO',p:87},38:{n:'ALTO',p:88},39:{n:'ALTO',p:88},40:{n:'ALTO',p:88},41:{n:'ALTO',p:88},42:{n:'ALTO',p:91},43:{n:'ALTO',p:91},44:{n:'ALTO',p:92},45:{n:'ALTO',p:92},46:{n:'ALTO',p:93},47:{n:'ALTO',p:93},48:{n:'ALTO',p:93},49:{n:'ALTO',p:95},50:{n:'ALTO',p:95},51:{n:'ALTO',p:96},52:{n:'ALTO',p:96},53:{n:'ALTO',p:96},54:{n:'ALTO',p:97},55:{n:'ALTO',p:98},56:{n:'ALTO',p:98},57:{n:'ALTO',p:98},58:{n:'ALTO',p:98},59:{n:'ALTO',p:98},60:{n:'ALTO',p:99}},
            Femenino: {12:{n:'BAJO',p:1},13:{n:'BAJO',p:2},14:{n:'BAJO',p:4},15:{n:'BAJO',p:5},16:{n:'BAJO',p:5},17:{n:'BAJO',p:8},18:{n:'BAJO',p:8},19:{n:'BAJO',p:9},20:{n:'BAJO',p:11},21:{n:'BAJO',p:11},22:{n:'MEDIO',p:12},23:{n:'MEDIO',p:18},24:{n:'MEDIO',p:19},25:{n:'MEDIO',p:20},26:{n:'MEDIO',p:23},27:{n:'MEDIO',p:26},28:{n:'MEDIO',p:31},29:{n:'MEDIO',p:37},30:{n:'MEDIO',p:41},31:{n:'MEDIO',p:50},32:{n:'MEDIO',p:53},33:{n:'MEDIO',p:56},34:{n:'MEDIO',p:59},35:{n:'MEDIO',p:62},36:{n:'MEDIO',p:64},37:{n:'MEDIO',p:66},38:{n:'MEDIO',p:70},39:{n:'MEDIO',p:73},40:{n:'MEDIO',p:76},41:{n:'MEDIO',p:81},42:{n:'MEDIO',p:84},43:{n:'ALTO',p:85},44:{n:'ALTO',p:90},45:{n:'ALTO',p:91},46:{n:'ALTO',p:92},47:{n:'ALTO',p:93},48:{n:'ALTO',p:96},49:{n:'ALTO',p:96},50:{n:'ALTO',p:97},51:{n:'ALTO',p:97},52:{n:'ALTO',p:97},53:{n:'ALTO',p:97},54:{n:'ALTO',p:97},55:{n:'ALTO',p:97},56:{n:'ALTO',p:97},57:{n:'ALTO',p:97},58:{n:'ALTO',p:97},59:{n:'ALTO',p:97},60:{n:'ALTO',p:99}}
        };
        
        const baremoConexion = {
            Masculino: {6:{n:'BAJO',p:1},7:{n:'BAJO',p:3},8:{n:'BAJO',p:4},9:{n:'BAJO',p:6},10:{n:'BAJO',p:8},11:{n:'BAJO',p:10},12:{n:'BAJO',p:12},13:{n:'MEDIO',p:16},14:{n:'MEDIO',p:21},15:{n:'MEDIO',p:23},16:{n:'MEDIO',p:25},17:{n:'MEDIO',p:35},18:{n:'MEDIO',p:38},19:{n:'MEDIO',p:50},20:{n:'MEDIO',p:55},21:{n:'MEDIO',p:63},22:{n:'MEDIO',p:66},23:{n:'MEDIO',p:72},24:{n:'ALTO',p:76},25:{n:'ALTO',p:85},26:{n:'ALTO',p:88},27:{n:'ALTO',p:90},28:{n:'ALTO',p:94},29:{n:'ALTO',p:96},30:{n:'ALTO',p:99}},
            Femenino: {6:{n:'BAJO',p:1},7:{n:'BAJO',p:1},8:{n:'BAJO',p:1},9:{n:'BAJO',p:2},10:{n:'BAJO',p:3},11:{n:'BAJO',p:3},12:{n:'BAJO',p:3},13:{n:'BAJO',p:4},14:{n:'BAJO',p:7},15:{n:'BAJO',p:15},16:{n:'MEDIO',p:18},17:{n:'MEDIO',p:23},18:{n:'MEDIO',p:27},19:{n:'MEDIO',p:35},20:{n:'MEDIO',p:39},21:{n:'MEDIO',p:46},22:{n:'MEDIO',p:50},23:{n:'MEDIO',p:55},24:{n:'MEDIO',p:63},25:{n:'MEDIO',p:74},26:{n:'MEDIO',p:85},27:{n:'ALTO',p:88},28:{n:'ALTO',p:91},29:{n:'ALTO',p:94},30:{n:'ALTO',p:95}}
        };
        
        const baremoAngustia = {
            Masculino: {9:{n:'BAJO',p:1},10:{n:'BAJO',p:12},11:{n:'MEDIO',p:14},12:{n:'MEDIO',p:19},13:{n:'MEDIO',p:25},14:{n:'MEDIO',p:37},15:{n:'MEDIO',p:40},16:{n:'MEDIO',p:42},17:{n:'MEDIO',p:46},18:{n:'MEDIO',p:51},19:{n:'MEDIO',p:59},20:{n:'MEDIO',p:61},21:{n:'MEDIO',p:67},22:{n:'MEDIO',p:71},23:{n:'MEDIO',p:78},24:{n:'MEDIO',p:80},25:{n:'MEDIO',p:82},26:{n:'MEDIO',p:84},27:{n:'MEDIO',p:85},28:{n:'ALTO',p:87},29:{n:'ALTO',p:88},30:{n:'ALTO',p:91},31:{n:'ALTO',p:91},32:{n:'ALTO',p:92},33:{n:'ALTO',p:92},34:{n:'ALTO',p:92},35:{n:'ALTO',p:93},36:{n:'ALTO',p:94},37:{n:'ALTO',p:95},38:{n:'ALTO',p:96},39:{n:'ALTO',p:97},40:{n:'ALTO',p:97},41:{n:'ALTO',p:97},42:{n:'ALTO',p:98},43:{n:'ALTO',p:98},44:{n:'ALTO',p:98},45:{n:'ALTO',p:99}},
            Femenino: {9:{n:'BAJO',p:1},10:{n:'BAJO',p:6},11:{n:'BAJO',p:12},12:{n:'BAJO',p:15},13:{n:'MEDIO',p:18},14:{n:'MEDIO',p:21},15:{n:'MEDIO',p:25},16:{n:'MEDIO',p:30},17:{n:'MEDIO',p:34},18:{n:'MEDIO',p:40},19:{n:'MEDIO',p:47},20:{n:'MEDIO',p:50},21:{n:'MEDIO',p:59},22:{n:'MEDIO',p:66},23:{n:'MEDIO',p:71},24:{n:'MEDIO',p:72},25:{n:'MEDIO',p:76},26:{n:'MEDIO',p:78},27:{n:'MEDIO',p:82},28:{n:'ALTO',p:84},29:{n:'ALTO',p:87},30:{n:'ALTO',p:90},31:{n:'ALTO',p:93},32:{n:'ALTO',p:93},33:{n:'ALTO',p:94},34:{n:'ALTO',p:94},35:{n:'ALTO',p:94},36:{n:'ALTO',p:95},37:{n:'ALTO',p:97},38:{n:'ALTO',p:97},39:{n:'ALTO',p:97},40:{n:'ALTO',p:97},41:{n:'ALTO',p:97},42:{n:'ALTO',p:98},43:{n:'ALTO',p:98},44:{n:'ALTO',p:98},45:{n:'ALTO',p:99}}
        };
        
        function getBaremo(score, sexo, tipo) {
            let baremo;
            if (tipo === 'phubbing') baremo = baremoPhubbing;
            else if (tipo === 'conexion') baremo = baremoConexion;
            else baremo = baremoAngustia;
            
            const b = baremo[sexo] || baremo.Masculino;
            if (b[score]) return b[score];
            for (let i = score; i >= 6; i--) if (b[i]) return b[i];
            return {n:'BAJO',p:1};
        }
        
        function render() {
            const app = document.getElementById('app');
            if (state.step === 'intro') {
                app.innerHTML = `
                    <div class="text-center mb-8">
                        <h1 class="text-4xl font-bold text-indigo-900 mb-4">Investigaci√≥n acerca del FOMO</h1>
                        <h2 class="text-2xl text-indigo-600 mb-6">Escala de FOMO de Estudiantes Universitarios (EFoMU)</h2>
                    </div>
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6 rounded">
                        <h3 class="font-bold text-lg mb-3">Introducci√≥n</h3>
                        <p class="mb-3">El siguiente formulario eval√∫a el Fear of Missing Out (FoMO) en estudiantes universitarios:</p>
                        <ul class="list-disc ml-6 space-y-2">
                            <li><strong>Dimensi√≥n conductual:</strong> phubbing y conexi√≥n compulsiva</li>
                            <li><strong>Dimensi√≥n emocional:</strong> angustia relacionada con la exclusi√≥n social</li>
                        </ul>
                    </div>
                    <div class="bg-gray-50 p-6 rounded mb-6">
                        <h3 class="font-bold text-lg mb-3">Escala de respuestas</h3>
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-2 text-sm">
                            <div class="bg-white p-3 rounded border">1 - Totalmente en desacuerdo</div>
                            <div class="bg-white p-3 rounded border">2 - En desacuerdo</div>
                            <div class="bg-white p-3 rounded border">3 - Ni de acuerdo ni en desacuerdo</div>
                            <div class="bg-white p-3 rounded border">4 - De acuerdo</div>
                            <div class="bg-white p-3 rounded border">5 - Totalmente de acuerdo</div>
                        </div>
                    </div>
                    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-6 mb-6 rounded">
                        <h3 class="font-bold text-lg mb-3">Informaci√≥n importante</h3>
                        <ul class="space-y-2">
                            <li>‚úì Participaci√≥n <strong>voluntaria</strong></li>
                            <li>‚úì Tiempo: <strong>10 minutos</strong></li>
                            <li>‚úì Informaci√≥n <strong>confidencial</strong></li>
                        </ul>
                    </div>
                    <div class="bg-gray-50 p-4 rounded mb-6 text-sm">
                        <p><strong>Investigadores:</strong> Nicole Velasco, Armando Paredes, Jhailys Santos, Nicole Bertel, Angie Caro, Hugo P√©rez</p>
                        <p><strong>Asesor:</strong> Profesor Jeison Neira</p>
                        <p><strong>Contacto:</strong> Velascon@utb.edu.co</p>
                    </div>
                    <button onclick="goToDemographics()" class="w-full bg-indigo-600 text-white py-4 rounded-lg font-bold text-lg hover:bg-indigo-700">Iniciar encuesta</button>
                `;
            } else if (state.step === 'demographics') {
                app.innerHTML = `
                    <h2 class="text-3xl font-bold text-gray-900 mb-6">Datos Sociodemogr√°ficos</h2>
                    <form onsubmit="submitDemographics(event)">
                        <div class="mb-6">
                            <label class="block font-bold mb-2">Nombre completo *</label>
                            <input type="text" id="nombre" class="w-full p-3 border-2 rounded-lg" required>
                        </div>
                        <div class="mb-6">
                            <label class="block font-bold mb-2">Sexo *</label>
                            <div class="space-y-2">
                                <label class="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="sexo" value="Masculino" required class="mr-3">
                                    <span>Masculino</span>
                                </label>
                                <label class="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="sexo" value="Femenino" class="mr-3">
                                    <span>Femenino</span>
                                </label>
                                <label class="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="sexo" value="Otro" class="mr-3">
                                    <span>Otro</span>
                                </label>
                            </div>
                        </div>
                        <div class="mb-6">
                            <label class="block font-bold mb-2">Edad *</label>
                            <input type="number" id="edad" min="18" max="25" class="w-full p-3 border-2 rounded-lg" required>
                        </div>
                        <div class="mb-6">
                            <label class="block font-bold mb-2">Estrato socioecon√≥mico *</label>
                            <select id="estrato" class="w-full p-3 border-2 rounded-lg" required>
                                <option value="">Seleccione</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <button type="button" onclick="goToIntro()" class="bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400">Volver</button>
                            <button type="submit" class="bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700">Continuar</button>
                        </div>
                    </form>
                `;
            } else if (state.step === 'survey') {
                const allQ = [...questions.phubbing, ...questions.conexion, ...questions.angustia];
                const answered = Object.keys(state.responses).length;
                const progress = (answered / allQ.length) * 100;
                
                app.innerHTML = `
                    <h2 class="text-3xl font-bold mb-4">Cuestionario EFoMU</h2>
                    <div class="mb-6">
                        <div class="text-right text-sm text-gray-600 mb-2">${answered} / ${allQ.length} respondidas</div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-indigo-600 h-2 rounded-full" style="width: ${progress}%"></div>
                        </div>
                    </div>
                    <form onsubmit="submitSurvey(event)">
                        <h3 class="text-xl font-bold text-indigo-700 mb-4 pb-2 border-b-2 border-indigo-200">Dimensi√≥n Conductual - Phubbing</h3>
                        ${renderQuestions(questions.phubbing)}
                        <h3 class="text-xl font-bold text-indigo-700 mb-4 pb-2 border-b-2 border-indigo-200">Dimensi√≥n Conductual - Conexi√≥n Impulsiva</h3>
                        ${renderQuestions(questions.conexion)}
                        <h3 class="text-xl font-bold text-indigo-700 mb-4 pb-2 border-b-2 border-indigo-200">Dimensi√≥n Emocional - Angustia</h3>
                        ${renderQuestions(questions.angustia)}
                        <div class="grid grid-cols-2 gap-4 mt-6">
                            <button type="button" onclick="goToDemographics()" class="bg-gray-300 text-gray-700 py-3 rounded-lg font-bold">Volver</button>
                            <button type="submit" class="bg-indigo-600 text-white py-3 rounded-lg font-bold">Ver resultados</button>
                        </div>
                    </form>
                `;
            } else if (state.step === 'result') {
                app.innerHTML = `
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold mb-2">Resultados de la Encuesta</h2>
                        <p class="text-gray-600">Gracias por completar el cuestionario EFoMU</p>
                    </div>
                    
                    <div class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-6 rounded-xl mb-6 text-center">
                        <h3 class="text-xl font-bold mb-2">Puntuaci√≥n Total</h3>
                        <div class="text-5xl font-bold">${state.result.totalScore}</div>
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-6 mb-6">
                        ${renderIndicadorCard('Phubbing', state.result.phubbing, 'blue')}
                        ${renderIndicadorCard('Conexi√≥n Impulsiva', state.result.conexion, 'purple')}
                        ${renderIndicadorCard('Angustia', state.result.angustia, 'pink')}
                    </div>
                    
                    <div class="bg-white border-2 p-6 rounded-xl mb-6">
                        <h3 class="font-bold text-lg mb-4">Interpretaci√≥n por Indicador</h3>
                        
                        <div class="mb-4 pb-4 border-b">
                            <h4 class="font-bold text-blue-700 mb-2">Phubbing - ${state.result.phubbing.nivel}</h4>
                            <p class="text-gray-700 text-sm">${getDescripcion(state.result.phubbing.nivel)}</p>
                        </div>
                        
                        <div class="mb-4 pb-4 border-b">
                            <h4 class="font-bold text-purple-700 mb-2">Conexi√≥n Impulsiva - ${state.result.conexion.nivel}</h4>
                            <p class="text-gray-700 text-sm">${getDescripcion(state.result.conexion.nivel)}</p>
                        </div>
                        
                        <div>
                            <h4 class="font-bold text-pink-700 mb-2">Angustia - ${state.result.angustia.nivel}</h4>
                            <p class="text-gray-700 text-sm">${getDescripcion(state.result.angustia.nivel)}</p>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 border-l-4 border-yellow-500 p-6 mb-6 rounded">
                        <p class="text-sm">Estos resultados son parte de una investigaci√≥n acad√©mica y no constituyen un diagn√≥stico cl√≠nico.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <button onclick="exportToExcel()" class="bg-green-600 text-white py-4 rounded-lg font-bold hover:bg-green-700">üì• Descargar resultados en Excel</button>
                        <button onclick="resetSurvey()" class="bg-indigo-600 text-white py-4 rounded-lg font-bold hover:bg-indigo-700">Realizar otra encuesta</button>
                    </div>
                `;
            }
        }
        
        function renderQuestions(qs) {
            return qs.map(q => `
                <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                    <p class="font-semibold mb-3">${q.text}</p>
                    <div class="flex flex-wrap gap-2">
                        ${[1,2,3,4,5].map(v => `
                            <label class="flex-1 min-w-[80px]">
                                <input type="radio" name="q${q.id}" value="${v}" ${state.responses[q.id] === v ? 'checked' : ''} onchange="updateResponse(${q.id}, ${v})" class="hidden">
                                <div class="p-3 text-center rounded-lg border-2 cursor-pointer ${state.responses[q.id] === v ? 'bg-indigo-600 text-white border-indigo-600' : 'bg-white border-gray-300'}">${v}</div>
                            </label>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }
        
        function renderIndicadorCard(nombre, data, color) {
            const colorClass = data.nivel === 'BAJO' ? 'bg-green-500' : data.nivel === 'MEDIO' ? 'bg-yellow-500' : 'bg-red-500';
            const bgColor = color === 'blue' ? 'bg-blue-50 border-blue-200' : color === 'purple' ? 'bg-purple-50 border-purple-200' : 'bg-pink-50 border-pink-200';
            const textColor = color === 'blue' ? 'text-blue-700' : color === 'purple' ? 'text-purple-700' : 'text-pink-700';
            
            return `
                <div class="${bgColor} p-6 rounded-xl border-2">
                    <h3 class="font-bold mb-3 ${textColor}">${nombre}</h3>
                    <div class="text-4xl font-bold ${textColor} text-center mb-3">${data.score}</div>
                    <div class="${colorClass} text-white px-4 py-2 rounded-full text-center font-bold mb-2">${data.nivel}</div>
                    <p class="text-sm text-gray-600 text-center">Percentil: ${data.percentil}</p>
                </div>
            `;
        }
        
        function getDescripcion(nivel) {
            if (nivel === 'BAJO') {
                return 'Presenta una presencia reducida en este indicador. Mantiene un uso m√°s regulado de redes sociales y no experimenta malestar significativo.';
            } else if (nivel === 'MEDIO') {
                return 'Muestra un nivel moderado en este indicador. Puede presentar preocupaciones ocasionales sin que interfiera significativamente en su vida diaria.';
            } else {
                return 'Se observa una presencia elevada en este indicador. Experimenta una fuerte necesidad de permanecer conectado que puede interferir con su funcionamiento.';
            }
        }
        
        function goToIntro() {
            state.step = 'intro';
            render();
        }
        
        function goToDemographics() {
            state.step = 'demographics';
            render();
        }
        
        function submitDemographics(e) {
            e.preventDefault();
            state.demographics = {
                nombre: document.getElementById('nombre').value,
                sexo: document.querySelector('input[name="sexo"]:checked').value,
                edad: document.getElementById('edad').value,
                estrato: document.getElementById('estrato').value
            };
            state.step = 'survey';
            render();
        }
        
        function updateResponse(id, value) {
            state.responses[id] = value;
            render();
        }
        
        function submitSurvey(e) {
            e.preventDefault();
            const allQ = [...questions.phubbing, ...questions.conexion, ...questions.angustia];
            const allAnswered = allQ.every(q => state.responses[q.id]);
            
            if (!allAnswered) {
                alert('Por favor responde todas las preguntas.');
                return;
            }
            
            const totalScore = Object.values(state.responses).reduce((a,b) => a+b, 0);
            const phubbingScore = questions.phubbing.reduce((sum, q) => sum + (state.responses[q.id] || 0), 0);
            const conexionScore = questions.conexion.reduce((sum, q) => sum + (state.responses[q.id] || 0), 0);
            const angustiaScore = questions.angustia.reduce((sum, q) => sum + (state.responses[q.id] || 0), 0);
            
            const phubbingResult = getBaremo(phubbingScore, state.demographics.sexo, 'phubbing');
            const conexionResult = getBaremo(conexionScore, state.demographics.sexo, 'conexion');
            const angustiaResult = getBaremo(angustiaScore, state.demographics.sexo, 'angustia');
            
            state.result = {
                totalScore,
                phubbing: {
                    score: phubbingScore,
                    nivel: phubbingResult.n,
                    percentil: phubbingResult.p
                },
                conexion: {
                    score: conexionScore,
                    nivel: conexionResult.n,
                    percentil: conexionResult.p
                },
                angustia: {
                    score: angustiaScore,
                    nivel: angustiaResult.n,
                    percentil: angustiaResult.p
                }
            };
            
            state.step = 'result';
            render();
        }
        
        function resetSurvey() {
            state.step = 'intro';
            state.demographics = {};
            state.responses = {};
            state.result = null;
            render();
        }
        
        function exportToExcel() {
            // Crear la estructura de datos para Excel
            const excelData = [];
            
            // FILA 1: Encabezados principales
            const headers = [
                'Nombre',
                'Sexo',
                'Edad',
                'Estrato'
            ];
            
            // Agregar encabezados de cada √≠tem de Phubbing
            questions.phubbing.forEach(q => {
                headers.push(`P${q.id}`);
            });
            
            // Agregar encabezados de cada √≠tem de Conexi√≥n Impulsiva
            questions.conexion.forEach(q => {
                headers.push(`P${q.id}`);
            });
            
            // Agregar encabezados de cada √≠tem de Angustia
            questions.angustia.forEach(q => {
                headers.push(`P${q.id}`);
            });
            
            // Agregar encabezados de resultados
            headers.push(
                'Punt_Phubbing',
                'Nivel_Phubbing',
                'Percentil_Phubbing',
                'Punt_Conexion',
                'Nivel_Conexion',
                'Percentil_Conexion',
                'Punt_Angustia',
                'Nivel_Angustia',
                'Percentil_Angustia',
                'Punt_Total'
            );
            
            excelData.push(headers);
            
            // FILA 2: Descripci√≥n de cada pregunta
            const preguntasRow = [
                'Nombre del participante',
                'Sexo del participante',
                'Edad del participante',
                'Estrato socioecon√≥mico'
            ];
            
            // Descripciones de Phubbing
            questions.phubbing.forEach(q => {
                preguntasRow.push(q.text);
            });
            
            // Descripciones de Conexi√≥n Impulsiva
            questions.conexion.forEach(q => {
                preguntasRow.push(q.text);
            });
            
            // Descripciones de Angustia
            questions.angustia.forEach(q => {
                preguntasRow.push(q.text);
            });
            
            // Descripciones de resultados
            preguntasRow.push(
                'Puntuaci√≥n Phubbing',
                'Nivel Phubbing',
                'Percentil Phubbing',
                'Puntuaci√≥n Conexi√≥n Impulsiva',
                'Nivel Conexi√≥n Impulsiva',
                'Percentil Conexi√≥n Impulsiva',
                'Puntuaci√≥n Angustia',
                'Nivel Angustia',
                'Percentil Angustia',
                'Puntuaci√≥n Total'
            );
            
            excelData.push(preguntasRow);
            
            // FILA 3: Datos del participante
            const dataRow = [
                state.demographics.nombre,
                state.demographics.sexo,
                state.demographics.edad,
                state.demographics.estrato
            ];
            
            // Respuestas de Phubbing (valores 1-5)
            questions.phubbing.forEach(q => {
                dataRow.push(state.responses[q.id] || '');
            });
            
            // Respuestas de Conexi√≥n Impulsiva (valores 1-5)
            questions.conexion.forEach(q => {
                dataRow.push(state.responses[q.id] || '');
            });
            
            // Respuestas de Angustia (valores 1-5)
            questions.angustia.forEach(q => {
                dataRow.push(state.responses[q.id] || '');
            });
            
            // Resultados finales por indicador
            dataRow.push(
                state.result.phubbing.score,
                state.result.phubbing.nivel,
                state.result.phubbing.percentil,
                state.result.conexion.score,
                state.result.conexion.nivel,
                state.result.conexion.percentil,
                state.result.angustia.score,
                state.result.angustia.nivel,
                state.result.angustia.percentil,
                state.result.totalScore
            );
            
            excelData.push(dataRow);
            
            // Crear hoja adicional con informaci√≥n de referencia
            const referenceData = [
                ['INFORMACI√ìN DE LA ENCUESTA FOMO - EFoMU'],
                [''],
                ['ESCALA DE RESPUESTAS'],
                ['Valor', 'Significado'],
                ['1', 'Totalmente en desacuerdo'],
                ['2', 'En desacuerdo'],
                ['3', 'Ni de acuerdo ni en desacuerdo'],
                ['4', 'De acuerdo'],
                ['5', 'Totalmente de acuerdo'],
                [''],
                ['DIMENSIONES E INDICADORES'],
                [''],
                ['Indicador', 'N¬∞ √çtems', 'Rango', 'Descripci√≥n'],
                ['Phubbing', '12', '12-60', 'Comportamiento de revisar el celular e interrumpir interacciones sociales presenciales (√çtems: 1, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14)'],
                ['Conexi√≥n Impulsiva', '6', '6-30', 'Necesidad compulsiva de revisar redes sociales y dispositivos sin motivo aparente (√çtems: 16, 17, 18, 23, 25, 26)'],
                ['Angustia', '9', '9-45', 'Malestar emocional relacionado con perderse eventos, publicaciones o informaci√≥n en redes sociales (√çtems: 31, 32, 33, 34, 36, 38, 39, 44, 45)'],
                [''],
                ['INTERPRETACI√ìN DE NIVELES'],
                [''],
                ['Nivel', 'Descripci√≥n'],
                ['BAJO', 'Presenta una presencia reducida en el indicador. Mantiene un uso m√°s regulado de redes sociales, no experimenta malestar significativo.'],
                ['MEDIO', 'Muestra un nivel moderado en el indicador. Puede presentar preocupaciones ocasionales sin que interfiera significativamente en su vida diaria.'],
                ['ALTO', 'Se observa una presencia elevada en el indicador. Experimenta una fuerte necesidad de permanecer conectado que puede interferir con su funcionamiento acad√©mico, emocional o social.'],
                [''],
                ['INVESTIGADORES'],
                ['Nicole Velasco, Armando Paredes, Jhailys Santos, Nicole Bertel, Angie Caro, Hugo P√©rez'],
                ['Asesor: Profesor Jeison Neira'],
                ['Contacto: Velascon@utb.edu.co']
            ];
            
            // Crear el libro de Excel
            const wb = XLSX.utils.book_new();
            
            // Agregar la hoja principal con todos los datos
            const ws1 = XLSX.utils.aoa_to_sheet(excelData);
            
            // Configurar anchos de columna (m√°s compactos)
            const colWidths = [
                {wch: 25},  // Nombre
                {wch: 12},  // Sexo
                {wch: 8},   // Edad
                {wch: 10}   // Estrato
            ];
            
            // Anchos para todas las preguntas (compacto para respuestas 1-5)
            const totalItems = questions.phubbing.length + questions.conexion.length + questions.angustia.length;
            for (let i = 0; i < totalItems; i++) {
                colWidths.push({wch: 8});  // Ancho compacto para las respuestas
            }
            
            // Anchos para columnas de resultados
            colWidths.push({wch: 15});  // Punt. Phubbing
            colWidths.push({wch: 15});  // Nivel Phubbing
            colWidths.push({wch: 15});  // Perc. Phubbing
            colWidths.push({wch: 15});  // Punt. Conexi√≥n
            colWidths.push({wch: 15});  // Nivel Conexi√≥n
            colWidths.push({wch: 15});  // Perc. Conexi√≥n
            colWidths.push({wch: 15});  // Punt. Angustia
            colWidths.push({wch: 15});  // Nivel Angustia
            colWidths.push({wch: 15});  // Perc. Angustia
            colWidths.push({wch: 15});  // Punt. Total
            
            ws1['!cols'] = colWidths;
            
            // Agregar la hoja de referencia
            const ws2 = XLSX.utils.aoa_to_sheet(referenceData);
            ws2['!cols'] = [{wch: 25}, {wch: 15}, {wch: 15}, {wch: 80}];
            
            XLSX.utils.book_append_sheet(wb, ws1, 'Datos');
            XLSX.utils.book_append_sheet(wb, ws2, 'Informaci√≥n');
            
            // Descargar el archivo
            const fecha = new Date().toLocaleDateString('es-CO').replace(/\//g, '-');
            const nombreArchivo = `FOMO_EFoMU_${state.demographics.nombre.replace(/\s/g, '_')}_${fecha}.xlsx`;
            XLSX.writeFile(wb, nombreArchivo);
        }
        
        render();
    </script>
</body>
</html>